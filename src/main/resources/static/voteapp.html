<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Welcome to the Digital Voting Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://peterolson.github.io/BigInteger.js/BigInteger.min.js"></script>
    <script src="googclosure.js"></script>
    <script src="cookie.js"></script>
    <script src="question.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"></head>
<body>
<link rel="stylesheet" type="text/css" href="voting.css" >
<!--
##MODULUS##
##EXPONENT##
##QUESTIONS##
-->

<div id="voterapp">
    <form action="logout">
        Welcome, {{ username }}
        <input type="submit" value="Log Out" class="loginbutton" >
    </form>
    <p/>
    <div v-show="allowedToVote" >
        <div v-for="question in votableQuestions" class="boxed">
            Question {{ question.id }}.<br/>
            {{ question.text }}
            <span v-if="question.closed" ><i>CLOSED</i></span>
            <!--
                TODO: make buttons unfocusable when they are in effect disabled
                 -->
            <div v-for="option in question.possibleResponses" >
                <button v-on:click="question.ballot.setCurrentlySelectedResponse(option.text)"
                        class="choice">
                    <i :class="question.ballot.classForOption(option.text)"></i>
                    {{ option.text }}
                </button>
            </div>
            <div v-if="question.canVote()">
                <button v-on:click="question.ballot.vote()" class="bigbutton">
                Submit Vote
                </button>
            </div>
            <div v-if="question.ballot.iVoted()">
                <button v-on:click="question.ballot.verifyVote()" class="bigbutton">
                    Verify Now
                </button>
            </div>
            <i>{{ question.ballot.verificationMessage }}</i>
            <span v-if="question.shouldShowResultsDetail()" >
                <div v-for="(count, opt) in question.ballot.results" >
                    <b>{{ opt }} :</b> <i> {{ count }} </i>
                </div>
            </span>
            <span v-if="question.ballot.total" >
                <b>Total votes counted: </b> {{ question.ballot.total }}
            </span>
        </div>
        <button v-if="isKeyInfoKnown" v-on:click="checkForNewQuestions" class="bigbutton" >
            <!-- TODO: Alan sez: don't need this button; users can refresh page. Make sure questions are sure to be fetched even if fetching key is laggy
            -->
            Refresh Question List
        </button>
        <button v-if="anyQuestionsVoted" v-on:click="verifyAll" class="bigbutton" >
            Verify All Now
        </button>
        <button v-if="!showOldQuestions" v-on:click="startShowingOldQuestions" class="bigbutton" >
            Show Old Questions
        </button>
    </div>
</div>
<script src="voting.js"></script>
</body>
</html>